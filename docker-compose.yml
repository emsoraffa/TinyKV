version: '3.8'

services:
  node1:
    image: tinykv:latest
    container_name: tinykv-node1
    build: .
    command: ./build/src/tinykv_server 50051
    ports:
      - "50051:50051"
    networks:
      - tinykv-net

  node2:
    image: tinykv:latest
    container_name: tinykv-node2
    command: ./build/src/tinykv_server 50052
    ports:
      - "50052:50052"
    depends_on:
      - node1
    networks:
      - tinykv-net

  node3:
    image: tinykv:latest
    container_name: tinykv-node3
    command: ./build/src/tinykv_server 50053
    ports:
      - "50053:50053"
    depends_on:
      - node1
    networks:
      - tinykv-net

  node4:
    image: tinykv:latest
    container_name: tinykv-node4
    command: ./build/src/tinykv_server 50054
    ports:
      - "50054:50054"
    depends_on:
      - node1
    networks:
      - tinykv-net

  node5:
    image: tinykv:latest
    container_name: tinykv-node5
    command: ./build/src/tinykv_server 50055
    ports:
      - "50055:50055"
    depends_on:
      - node1
    networks:
      - tinykv-net

networks:
  tinykv-net:
    driver: bridge
    name: tinykv-net
